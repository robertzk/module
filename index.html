<!DOCTYPE html>
<html lang="en" class="">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="description" content="An R namespace system that supersedes packages by allowing nesting.">

    <title>module (http://github.com/robertzk/module)</title>

    <link rel="stylesheet" media="all" href="stylesheets/rocco.css" />
    <link rel="stylesheet" media="all" href="stylesheets/github-markdown.css" />

    <script src="assets/highlight.pack.js"></script>
    <script type="text/javascript">
      hljs.initHighlightingOnLoad();
    </script>

    <style type="text/css">
      .header {
        position: fixed;
        top: 0px;
        width: 100%;
        background-color: rgba(0, 0, 0, 0.25);
        padding: 10px;
      }
      
      .header a {
        padding-right: 30px;
      }

      .container {
        margin-top: 40px;
      }

      body {
        padding: 0;
        margin: 0;
      }

      div.code-background {
        float: right;
        position: fixed;
        z-index: -1;
        height: 100%;
        background-color: #f8f8ff;
        width: 60%;
        right: 0px;
      }

      div.section {
        clear: both;
        margin: 0; padding: 0;
      }

      div.code {
        float: right;
        width: 60%;
      }

      code.R {
        font-size: 1.2em;
        line-height: 2em;
        margin-top: 0em;
        margin-bottom: -2em;
        padding-top: 0;
        margin-top: -1em;
      }

      code.R > span.spacer {
        position: relative;
      }

      div.code > pre {
        margin: 0;
        padding-left: 2em;
        margin-top: 0;
        margin-bottom: 0;
      }

      div.markdown {
        padding: 1em;
        padding-top: 0;
        background: #fff;
        float: left;
        width: 35%;
      }
    </style>

  </head>

  <body>
    <div class="header">
      <a href="https://github.com/robertzk/rocco">
        <img id="rocco-logo" src="https://img.shields.io/badge/Generated by rocco_v0.1.1-%E2%9C%93-blue.svg"/>
      </a>
    </div>
    <div class="container">

      <div class="code-background"></div>

        <div class="section">
          <div class="markdown markdown-body">
            <h1>messages.R</h1>

          </div>

          <div class="code">
            <pre>
              <code class="R"><span class="spacer"></span></code>
            </pre>
          </div>
        </div>
        <div class="section">
          <div class="markdown markdown-body">
            <p>A dictionary of messages used by the package.
We separate these into its own file to avoid cluttering
the R code with a multitude of strings.</p>

          </div>

          <div class="code">
            <pre>
              <code class="R"><span class="spacer">messages <- list(
  invalid_module_path = c("Invalid path passed to the ",
    sQuote("path"), " parameter to the ", sQuote("module"),
    " function: I received a ", crayon::red("{{{klass}}}"), 
    " but was expecting a ", crayon::yellow("character"), "."),

  invalid_module_character_path = c("Invalid path passed to the ",
    sQuote("path"), " parameter to the ", sQuote("module"),
    " function: I expected a non-NA non-blank character vector
    of length 1")
)
</span></code>
            </pre>
          </div>
        </div>
        <div class="section">
          <div class="markdown markdown-body">
            <p>Cleanse the message a little after fetching it from the <code>messages</code> list.</p>

          </div>

          <div class="code">
            <pre>
              <code class="R"><span class="spacer">msg <- function(name) {
  stopifnot(name %in% names(messages))
</span></code>
            </pre>
          </div>
        </div>
        <div class="section">
          <div class="markdown markdown-body">
            <p>The <code>gsub</code> will squish multiple spaces into a single space,
while the <code>paste(collapse = &quot;&quot;, ...)</code> usage will ensure we
can take vectors of characters in the above <code>messages</code> list.</p>

          </div>

          <div class="code">
            <pre>
              <code class="R"><span class="spacer">  paste(collapse = "", gsub("[ ]+", " ", messages[[name]]))
}
</span></code>
            </pre>
          </div>
        </div>
        <div class="section">
          <div class="markdown markdown-body">
            <p>We use the <a href="https://github.com/edwindj/whisker">whisker</a> templating
engine to inject any additional values into the message string.
For example,</p>

<pre><code class="r">m(&quot;invalid_module_path&quot;, klass = &quot;bloop&quot;)
</code></pre>

<p>would return the appropriate error with the string &ldquo;bloop&rdquo; injected
in the appropriate place.</p>

          </div>

          <div class="code">
            <pre>
              <code class="R"><span class="spacer">m <- function(name, ...) {</span></code>
            </pre>
          </div>
        </div>
        <div class="section">
          <div class="markdown markdown-body">
            <p>Note the use of <a href="http://www.inside-r.org/r-doc/base/do.call"><code>do.call</code></a>,
a very handy R metaprogramming tool when we do not know exactly which 
arguments we will pass.</p>

          </div>

          <div class="code">
            <pre>
              <code class="R"><span class="spacer">  do.call(whisker::whisker.render, list(msg(name), list(...)))
}

</span></code>
            </pre>
          </div>
        </div>
        <div class="section">
          <div class="markdown markdown-body">
            <h1>module.R</h1>

          </div>

          <div class="code">
            <pre>
              <code class="R"><span class="spacer"></span></code>
            </pre>
          </div>
        </div>
        <div class="section">
          <div class="markdown markdown-body">
            
          </div>

          <div class="code">
            <pre>
              <code class="R"><span class="spacer"># TODO: (RK) Dcoument modules more extensively.</span></code>
            </pre>
          </div>
        </div>
        <div class="section">
          <div class="markdown markdown-body">
            <p>Typical modularization of R code is done through <a href="http://r-pkgs.had.co.nz/">packages</a>.
However, packages have a few design limitations that prevents
their widespread use by developers.</p>

<ol>
<li>Packages do not solve the problem of hierarchical namespacing.
 In particular, languages like Ruby have good support for
 a primitive called a <a href="http://ruby-doc.org/core-2.2.0/Module.html">module</a> and
 C++ has a primitive term a <a href="https://en.wikipedia.org/wiki/Namespace">namespace</a>.;
 R, despite being a functional languages with roots to the <a href="https://en.wikipedia.org/wiki/LISP">LISP</a>
 currently does not have a good hierachical namespacing system.</li>
<li>Hierarchical file structures and exports. In particular, R packages
 are limited to flat directory structures for historical reasons
 decided by the R core team.</li>
</ol>

<p>Both of these limitations are legitimate problems because organizing
large codebases managed by teams of dozens or hundreds of developers
is difficult or unpleasant without a sane hierarchical namespacing system.</p>

<p><strong>Modules</strong> aim to partially allay this problem by building a hierarchical
namespacing mechanism on top of <a href="http://adv-r.had.co.nz/Environments.html">environments</a>,
a well-defined and well-understood primitive data structure in R.</p>

          </div>

          <div class="code">
            <pre>
              <code class="R"><span class="spacer">#' Load and attach an R module in the current environment.
#'
#' Modules are light wrappers around environments that provide
#' better support for hierarching namespacing.
#'
#' @param path character. If \code{path} is a character vector giving
#'   an installed package in the current library path, a module
#'   encompassing that package will be returned. Otherwise, the
#'   directory given by the path will be loaded as a module.
#' @return a \code{module} object.
module <- function(path) {
  if (!is.character(path)) {
    stop(m("invalid_module_path", klass = class(path)[1L]))
  }
  
  if (!is.simple_string(path)) {
    stop(m("invalid_module_character_path"))
  }

  module_(path)
}

module_ <- function(path) {
  if (package_exists(path)) {
    object <- package(path)
  } else {
    object <- file(path)
  }

  module_new(object)
}

module_new <- function(object) {
  UseMethod("module_new")
}

module_new.file <- function(object) {
  NULL
}

module_new.package <- function(object) {
  NULL
}
</span></code>
            </pre>
          </div>
        </div>
        <div class="section">
          <div class="markdown markdown-body">
            <h1>package.module.R</h1>

          </div>

          <div class="code">
            <pre>
              <code class="R"><span class="spacer"></span></code>
            </pre>
          </div>
        </div>
        <div class="section">
          <div class="markdown markdown-body">
            
          </div>

          <div class="code">
            <pre>
              <code class="R"><span class="spacer">#' An R namespace system that supersedes packages by allowing nesting.
#'
#' @name module
#' @import module
#' @docType package
NULL</span></code>
            </pre>
          </div>
        </div>
        <div class="section">
          <div class="markdown markdown-body">
            <h1>package.R</h1>

          </div>

          <div class="code">
            <pre>
              <code class="R"><span class="spacer"></span></code>
            </pre>
          </div>
        </div>
        <div class="section">
          <div class="markdown markdown-body">
            
          </div>

          <div class="code">
            <pre>
              <code class="R"><span class="spacer">#' An S3 class representing metadata about a package.
#'
#' @param name character. The name of the package. It
#'   must be installed in the user's currently active
#'   library.
package <- function(name) {
  # TODO: (RK) Find path using system.file, determine
  # if installed.
  structure(list(name = name), class = "package")
}
</span></code>
            </pre>
          </div>
        </div>
        <div class="section">
          <div class="markdown markdown-body">
            <h1>utils.R</h1>

          </div>

          <div class="code">
            <pre>
              <code class="R"><span class="spacer"></span></code>
            </pre>
          </div>
        </div>
        <div class="section">
          <div class="markdown markdown-body">
            
          </div>

          <div class="code">
            <pre>
              <code class="R"><span class="spacer">`%||%` <- function(x, y) if (is.null(x)) y else x

is.simple_string <- function(x) {
  is.character(x) && length(x) == 1 &&
  !is.na(x) && nzchar(x)
}

file <- function(path) {
}</span></code>
            </pre>
          </div>
        </div>
      <div class="section">
      </div>

    </div>
  </body>
</html>
